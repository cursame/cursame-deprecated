/*!
 * jQuery Expander Plugin v1.3
 *
 * Date: Sat Sep 17 00:37:34 2011 EDT
 * Requires: jQuery v1.3+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses (just like jQuery):
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 *
 *
 *
*/
(function(a){a.expander={version:"1.3",defaults:{slicePoint:100,preserveWords:!0,widow:4,expandText:"read more",expandPrefix:"&hellip; ",summaryClass:"summary",detailClass:"details",moreClass:"read-more",lessClass:"read-less",collapseTimer:0,expandEffect:"fadeIn",expandSpeed:250,collapseEffect:"fadeOut",collapseSpeed:200,userCollapse:!0,userCollapseText:"read less",userCollapsePrefix:" ",onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null}},a.fn.expander=function(b){function k(a,b){var c="span",d=a.summary;return b?(c="div",d=d.replace(/(<\/[^>]+>)\s*$/,a.moreLabel+"$1"),d='<div class="'+a.summaryClass+'">'+d+"</div>"):d+=a.moreLabel,[d,"<",c+' class="'+a.detailClass+'"',">",a.details,"</"+c+">"].join("")}function l(a){var b='<span class="'+a.moreClass+'">'+a.expandPrefix;return b+='<a href="#">'+a.expandText+"</a></span>",b}function m(a,b){return a.lastIndexOf("<")>a.lastIndexOf(">")&&(a=a.slice(0,a.lastIndexOf("<"))),b&&(a=a.replace(e,"")),a}function n(a,b){b.stop(!0,!0)[a.collapseEffect](a.collapseSpeed,function(){var c=b.prev("span."+a.moreClass).show();c.length||b.parent().children("div."+a.summaryClass).show().find("span."+a.moreClass).show()})}function o(b,c,d){b.collapseTimer&&(j=setTimeout(function(){n(b,c),a.isFunction(b.onCollapse)&&b.onCollapse.call(d,!1)},b.collapseTimer))}var c=a.extend({},a.expander.defaults,b),d=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,e=/(&(?:[^;]+;)?|\w+)$/,f=/<\/?(\w+)[^>]*>/g,g=/<(\w+)[^>]*>/g,h=/<\/(\w+)>/g,i=/^<[^>]+>.?/,j;return this.each(function(){function O(a){a.preventDefault(),w.hide(),C.hide(),z.beforeExpand&&D.beforeExpand.call(A),v.stop(!1,!0)[D.expandEffect](J,function(){v.css({zoom:""}),z.afterExpand&&D.afterExpand.call(A),o(D,v,A)})}var b,e,p,q,r,s,t,u,v,w,x=[],y=[],z={},A=this,B=a(this),C=a([]),D=a.meta?a.extend({},c,B.data()):c,E=!!B.find("."+D.detailClass).length,F=!!B.find("*").filter(function(){var b=a(this).css("display");return/^block|table|list/.test(b)}).length,G=F?"div":"span",H=G+"."+D.detailClass,I="span."+D.moreClass,J=D.expandSpeed||0,K=a.trim(B.html()),L=a.trim(B.text()),M=K.slice(0,D.slicePoint);if(a.data(this,"expander"))return;a.data(this,"expander",!0),a.each(["onSlice","beforeExpand","afterExpand","onCollapse"],function(b,c){z[c]=a.isFunction(D[c])}),M=m(M),summTagless=M.replace(f,"").length;while(summTagless<D.slicePoint)newChar=K.charAt(M.length),newChar=="<"&&(newChar=K.slice(M.length).match(i)[0]),M+=newChar,summTagless++;M=m(M,D.preserveWords),r=M.match(g)||[],s=M.match(h)||[],p=[],a.each(r,function(a,b){d.test(b)||p.push(b)}),r=p,e=s.length;for(b=0;b<e;b++)s[b]=s[b].replace(h,"$1");a.each(r,function(b,c){var d=c.replace(g,"$1"),e=a.inArray(d,s);e===-1?(x.push(c),y.push("</"+d+">")):s.splice(e,1)}),y.reverse();if(!E){u=K.slice(M.length);if(u.split(/\s+/).length<D.widow&&!E)return;t=y.pop()||"",M+=y.join(""),u=x.join("")+u}else u=B.find(H).remove().html(),M=B.html(),K=M+u,t="";D.moreLabel=B.find(I).length?"":l(D),F&&(u=K),M+=t,D.summary=M,D.details=u,D.lastCloseTag=t,z.onSlice&&(p=D.onSlice.call(A,D),D=p&&p.details?p:D);var N=k(D,F);B.html(N),v=B.find(H),w=B.find(I),v.hide(),w.find("a").unbind("click.expander").bind("click.expander",O),C=B.find("div."+D.summaryClass),D.userCollapse&&!B.find("span."+D.lessClass).length&&B.find(H).append('<span class="'+D.lessClass+'">'+D.userCollapsePrefix+'<a href="#">'+D.userCollapseText+"</a></span>"),B.find("span."+D.lessClass+" a").unbind("click.expander").bind("click.expander",function(b){b.preventDefault(),clearTimeout(j);var c=a(this).closest(H);n(D,c),z.onCollapse&&D.onCollapse.call(A,!0)})}),this},a.fn.expander.defaults=a.expander.defaults})(jQuery);