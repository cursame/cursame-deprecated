/**
 * @class Command.Preprocessor
 * @author Jacky Nguyen <jacky@sencha.com>
 */
Ext.define("Command.Preprocessor",{statics:{getInstance:function(){return this.instance||(this.instance=new this),this.instance}},params:{},process:function(a){var b=Ext.create("Command.preprocessor.LineStack",a);return Ext.create("Command.preprocessor.Statement").process(b)},evaluate:function(a,b){var c=this.params,d=null,e=c.hasOwnProperty(a)?c[a]:!1,f;b===undefined&&(b=!0),Ext.isString(b)&&(f=b.match(/^(!=*|<=|>=|<|>|=+)/),f&&(d=f[0],b=b.slice(d.length)),b==="true"?b=!0:b==="false"?b=!1:isNaN(b)||(b=parseFloat(b)));switch(d){case"!==":case"!=":case"!":return e!==b;case">":return e>b;case"<":return e<b;case"<=":return e<=b;case">=":return e>=b;case"==":return e==b;case"=":case"===":default:return e===b}},setParams:function(a){this.params=a||{}},isCloseOf:function(a,b){return b.type?a.trim().match(new RegExp("^\\/\\/(?:\\t|\\s)*<\\/"+(b.isInverted?"!":"")+b.type+">$"))!==null:!1},isStatement:function(a){return this.parseStatementParts(a)!==null},parseStatementParts:function(a){return a.trim().match(/^\/\/(?:\t|\s)*<([^\/]+)>$/)},parseStatementProperties:function(a){var b={},c=function(b){var c=a.match(b);return c!==null?(a=a.slice(c[0].length),c[0]):null},d,e,f,g,h;while(a.length>0){c(/^[^\w]+/i),d=c(/^[\w\.\-_]+/i);if(d===null)break;e=c(/^=/);if(e===null){b[d]=!0;continue}f=c(/^('|")/i),g=f||"\\s",h=c(new RegExp("^[^"+g+"]+")),f!==null&&c(new RegExp(f)),b[d]=h}return b},parseStatement:function(a){a=a.trim();var b=this.parseStatementParts(a),c,d;return b===null?!1:(a=b[1],c=a.match(/^(!)?([\w]+)/i),c===null?!1:(d={properties:{}},d.type=c[2],d.isInverted=c[1]!==undefined,a=a.substr(c[0].length,a.length).trim(),d.properties=this.parseStatementProperties(a),d))}});