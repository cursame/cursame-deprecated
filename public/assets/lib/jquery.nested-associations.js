// macario ortega
// github.com/maca
// mit licence
(function(a){a.fn.nestedAssociationsChangeId=function(b,c){a(this).find("[id], [for], [name]").each(function(){var d=a(this);a.each(["id","for","name"],function(a,e){var f=d.attr(e);if(f&&e=="name"){var g=new RegExp("\\["+b+"_attributes\\]\\[\\d+\\]");d.attr(e,f.replace(g,"["+b+"_attributes]["+c+"]"))}else if(f){var g=new RegExp(b+"_attributes_\\d+");d.attr(e,f.replace(g,b+"_attributes_"+c))}})})},a.fn.nestedAssociations=function(b){var c=a(this),d=c,e={add:a.noop,remove:a.noop};return b&&a.extend(e,b),a(this).find("input[id$=_destroy]").closest("label").each(function(){var b=a('<a href="#" class="remove-associated-record">').text(a(this).text());b.click(function(){return a(this).siblings("input").attr("value","1"),e.remove.apply(a(this).closest("fieldset").slideUp()),!1}),a(this).hide().after(b)}),d.each(function(){var b=a(this),c=b.attr("data-association"),d=b.children("fieldset.new").last().detach();b.children("a.add_record").show().click(function(){var b=d.clone(!0);return a(this).before(b.hide()),a(this).parents("fieldset[data-association]").each(function(){var b=a(this).attr("data-association");a(this).children("fieldset.new").each(function(){a(this).nestedAssociationsChangeId(b,(new Date).getTime())})}),b.slideDown(function(){e.add.apply(this)}),!1})})}})(jQuery);